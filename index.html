<!DOCTYPE html>
<html>
<!--
  Created using jsbin.com
  Source can be edited via http://jsbin.com/kringle/44/edit
-->
<head>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<meta charset=utf-8 />
<title>Kringlr</title>

<style id="jsbin-css">
body {
  font: 12px sans-serif;
  padding: 10px;
}
.corpus {
  height: 50px;
  width: 100%;
}
#output {
  border: lightGreen 1px solid;
  font: 14px 'Georgia';
  padding: 0 20px;
  margin: 20px 0;
}
#dump {
  display: none;
  margin: 20px 0;
  white-space: pre;
  height: 400px;
  overflow: hidden;
  overflow-y: scroll;
  border: solid 1px #ccc
}
.hilight {
  font-weight: bold;
}
</style>
</head>
<body>
  
  <script>
    util = {
      commonWords: "br a able about above across after all almost along already also always am an and any anybody anyone anything anyway anyways anywhere apart are aren't around as ask asking at away be because been before behind being below best better between both but by c'mon came can can't cant clearly come comes could couldn't did didn't do does doesn't doing don't done each either else etc even ever every everybody everyone everything everywhere exactly except far few first followed following follows for from get gets getting given gives go goes going gone got gotten had hadn't happens hardly has hasn't have haven't having he he's her here here's hers herself him himself his how however i i'd i'll i'm i've if in instead into is isn't it it'd it'll it's its itself just keep keeps kept let's many may maybe me might more much my neither no not nothing now of oh ok okay old on once one ones only onto or other others our ours ourselves out over own probably quite really right said same saw say saying says see seeing seem seemed seeming seems seen she should shouldn't since so some somebody somehow someone something sometime sometimes somewhere soon still such sure take taken tell than that that's thats the their theirs them themselves then there there's theres these they they'd they'll they're they've this those though through thru to together too took toward towards tried tries truly try trying twice under unfortunately until up us use used uses using usually very vs was wasn't way we we'd we'll we're we've well went were weren't what what's when where where's whether which while who who's whoever whole whom whose will with within without won't would wouldn't yes yet you you'd you'll you're you've your yours yourself yourselves",
      isInString: function(needle, haystack) {
        return (' '+haystack+' ').indexOf(' '+needle+' ') > -1;
      },
      isRelevant: function(input) {
        return !util.isInString(input.toLowerCase(), util.commonWords);
      },
      twitterScrape: function(str){
        return str
          .match(/\n\S[^\n]*/g)
          .filter(function(v){return !(/^\nExpand|^\nFollowed/g).test(v);})
          .join();
      }
    };
  </script>
  <!-- best of:
  
As far away the song high above the pudding 
With every heart be merry little lamb 
Rejoice Emmanuel 
Fa la la la la la la 

Of old year 
Hark The King 
He will be white 
Rudolph the Lord

The angels sing 
Hang your King 
Whose forms are bending low 
That's when those blue Christmas 
If we get some homemade pumpkin pie 
Here comes Santa Claus here comes Santa Claus here with healing in solemn stillness lay 
Here we are bending low 
our hearts will be the Law
  
Stillness lay before the Lord of toys and Heaven and say it is no such thing as for the curse is terrific 
We all from our need our Father now embrace 
He'll come let us adore Him in lonely exile here comes Santa Claus comes tonight 
For yonder breaks a white 
With the angels sing


But do you pa rum pum pum 
Misfortune seemed his reindeer 
Whose forms are as the most wonderful time of yore


Why this blessed angels sing 
Was seated by the earth 
But as a man who are bending low 
If you see if reindeer of all aglow

And still their King pa rum pum rum pum 
'Cause Santa came upon the Highest


Pennsylvania and nature sing 


Music floats 
Walkin' home for the year 
Rejoiced much egg nog 
Deck the earth goodwill to Bethlehem was born on an open sleigh


The Child 
I'm dreaming of angels sing 
In a cup of the harp and lamb to the weary world rejoices 
They know
-->
  <p>Input</p>
  <textarea id="kringle" class="corpus">
Chestnuts roasting on an open fire,
Jack Frost nipping on your nose,
Yuletide carols being sung by a choir,
And folks dressed up like Eskimos.

Everybody knows a turkey and some mistletoe,
Help to make the season bright.
Tiny tots with their eyes all aglow,
Will find it hard to sleep tonight.

They know that Santa's on his way;
He's loaded lots of toys and many goodies on his sleigh.
And every mother's child is gonna spy,
To see if reindeer really know how to fly.

And so I'm offering this simple phrase,
To kids from one to ninety-two,
Although its been said many times, many ways,
Merry Christmas to you
    
   
Dashing through the snow
In a one horse open sleigh
O'er the fields we go
Laughing all the way
Bells on bob tails ring
Making spirits bright
What fun it is to laugh and sing
A sleighing song tonight

Oh, jingle bells, jingle bells
Jingle all the way
Oh, what fun it is to ride
In a one horse open sleigh
Jingle bells, jingle bells
Jingle all the way
Oh, what fun it is to ride
In a one horse open sleigh

A day or two ago
I thought I'd take a ride
And soon Miss Fanny Bright
Was seated by my side
The horse was lean and lank
Misfortune seemed his lot
We got into a drifted bank
And then we got upsot

Oh, jingle bells, jingle bells
Jingle all the way
Oh, what fun it is to ride
In a one horse open sleigh
Jingle bells, jingle bells
Jingle all the way
Oh, what fun it is to ride
In a one horse open sleigh yeah

Jingle bells, jingle bells
Jingle all the way
Oh, what fun it is to ride
In a one horse open sleigh
Jingle bells, jingle bells
Jingle all the way
Oh, what fun it is to ride
In a one horse open sleigh
    
    
Silent night, holy night
All is calm, all is bright
Round yon Virgin Mother and Child
Holy Infant so tender and mild
Sleep in heavenly peace
Sleep in heavenly peace

Silent night, holy night!
Shepherds quake at the sight
Glories stream from heaven afar
Heavenly hosts sing Alleluia!
Christ, the Saviour is born
Christ, the Saviour is born

Silent night, holy night
Son of God, love's pure light
Radiant beams from Thy holy face
With the dawn of redeeming grace
Jesus, Lord, at Thy birth
Jesus, Lord, at Thy birth
    

O Holy Night! The stars are brightly shining, 
It is the night of the dear Saviour's birth. 
Long lay the world in sin and error pining. 
Till He appeared and the Spirit felt its worth. 
A thrill of hope the weary world rejoices, 
For yonder breaks a new and glorious morn. 
Fall on your knees! Oh, hear the angel voices! 
O night divine, the night when Christ was born; 
O night, O Holy Night , O night divine! 
O night, O Holy Night , O night divine! 

Led by the light of faith serenely beaming, 
With glowing hearts by His cradle we stand. 
O'er the world a star is sweetly gleaming, 
Now come the wisemen from out of the Orient land. 
The King of kings lay thus lowly manger; 
In all our trials born to be our friends. 
He knows our need, our weakness is no stranger, 
Behold your King! Before him lowly bend! 
Behold your King! Before him lowly bend! 

Truly He taught us to love one another, 
His law is love and His gospel is peace. 
Chains he shall break, for the slave is our brother. 
And in his name all oppression shall cease. 
Sweet hymns of joy in grateful chorus raise we, 
With all our hearts we praise His holy name. 
Christ is the Lord! Then ever, ever praise we, 
His power and glory ever more proclaim! 
His power and glory ever more proclaim!

    
Have yourself a merry little Christmas,
Let your heart be light
From now on,
our troubles will be out of sight

Have yourself a merry little Christmas,
Make the Yule-tide gay,
From now on, 
our troubles will be miles away.

Here we are as in olden days,
Happy golden days of yore.
Faithful friends who are dear to us
Gather near to us once more.

Through the years 
We all will be together,
If the Fates allow
Hang a shining star upon the highest bough.
And have yourself A merry little Christmas now. 

    
It's the most wonderful time of the year 
With the kids jingle belling
And everyone telling you "Be of good cheer" 
It's the most wonderful time of the year 
It's the hap-happiest season of all
With those holiday greetings and gay happy meetings 
When friends come to call 
It's the hap- happiest season of all 

There'll be parties for hosting 
Marshmallows for toasting 
And caroling out in the snow 
There'll be scary ghost stories 
And tales of the glories of 
Christmases long, long ago 

It's the most wonderful time of the year 
There'll be much mistltoeing 
And hearts will be glowing 
When love ones are near 
It's the most wonderful time of the year 

There'll be parties for hosting 
Marshmallows for toasting 
And caroling out in the snow 
There'll be scary ghost stories 
And tales of the glories of 
Christmases long, long ago 

It's the most wonderful time of the year 
There'll be much mistltoeing 
And hearts will be glowing 
When love ones are near 
It's the most wonderful time 
It's the most wonderful time 
It's the most wonderful time 
It's the most wonderful time of the year


Oh, there's no place like home for the holidays,
For no matter how far away you roam -
When you long for the sunshine of a friendly gaze,
For the holidays - you can't beat home, sweet home!

I met a man who lives in Tennessee, and he was headin' for 
Pennsylvania and some homemade pumpkin pie;
From Pennsylvania folks are travelin' down Dixie's sunny shore;
From Atlantic to Pacific -
Gee, the traffic is terrific!

Oh there's no place like home for the holidays, 
'Cause no matter how far away you roam -
If you want to be happy in a million ways,
For the holidays - you can't beat home, sweet home

I met a man who lives in Tennessee and he was headin' for 
Pennsylvania and some homemade pumpkin pie;
From Pennsylvania folks are travelin' down Dixie's sunny shore;
From Atlantic to Pacific -
Gee, the traffic is terrific!

Oh, there's no place like home for the holidays,
'Cause no matter how far away you roam -
If you want to be happy in a million ways,
For the holidays - you can't beat home, sweet home!
For the holidays - you can't beat home, sweet home!
    

Come they told me, pa rum pum pum pum 
A new born King to see, pa rum pum pum pum 
Our finest gifts we bring, pa rum pum pum pum 
To lay before the King, pa rum pum pum pum, 
rum pum pum pum, rum pum pum pum,

So to honor Him, pa rum pum pum pum, 
When we come. 

Little Baby, pa rum pum pum pum 
I am a poor boy too, pa rum pum pum pum 
I have no gift to bring, pa rum pum pum pum 
That's fit to give the King, pa rum pum pum pum, 
rum pum pum pum, rum pum pum pum, 

Shall I play for you, pa rum pum pum pum, 
On my drum? 

Mary nodded, pa rum pum pum pum 
The ox and lamb kept time, pa rum pum pum pum 
I played my drum for Him, pa rum pum pum pum 
I played my best for Him, pa rum pum pum pum, 
rum pum pum pum, rum pum pum pum, 

Then He smiled at me, pa rum pum pum pum 
Me and my drum.
    
    
I'm dreaming of a white Christmas 
Just like the ones I used to know 
Where the treetops glisten, 
and children listen 
To hear sleigh bells in the snow

I'm dreaming of a white Christmas 
With every Christmas card I write 
May your days be merry and bright 
And may all your Christmases be white 

I'm dreaming of a white Christmas 
With every Christmas card I write 
May your days be merry and bright 
And may all your Christmases be white

    
Jingle bell, jingle bell, jingle bell rock
Jingle bells swing and jingle bells ring
Snowing and blowing up bushels of fun
Now the jingle hop has begun

Jingle bell, jingle bell, jingle bell rock
Jingle bells chime in jingle bell time
Dancing and prancing in Jingle Bell Square
In the frosty air.

What a bright time, it's the right time
To rock the night away

Jingle bell time is a swell time
To go gliding in a one-horse sleigh
Giddy-up jingle horse, pick up your feet
Jingle around the clock

Mix and a-mingle in the jingling feet
That's the jingle bell,
That's the jingle bell,
That's the jingle bell rock


Joy to the World , the Lord is come!
Let earth receive her King;
Let every heart prepare Him room,
And Heaven and nature sing,
And Heaven and nature sing,
And Heaven, and Heaven, and nature sing.

Joy to the World, the Savior reigns!
Let men their songs employ;
While fields and floods, rocks, hills and plains
Repeat the sounding joy,
Repeat the sounding joy,
Repeat, repeat, the sounding joy.

No more let sins and sorrows grow,
Nor thorns infest the ground;
He comes to make His blessings flow
Far as the curse is found,
Far as the curse is found,
Far as, far as, the curse is found.

He rules the world with truth and grace,
And makes the nations prove
The glories of His righteousness,
And wonders of His love,
And wonders of His love,
And wonders, wonders, of His love.


It came upon the midnight clear,
That glorious song of old,
From angels bending near the earth,
To touch their harps of gold:
"Peace on the earth, goodwill to men
From heavens all gracious King!"
The world in solemn stillness lay
To hear the angels sing.

Still through the cloven skies they come,
With peaceful wings unfurled;
And still their heavenly music floats
O'er all the weary world:
Above its sad and lowly plains
They bend on hovering wing,
And ever o'er its Babel sounds
The blessed angels sing.

O ye beneath life's crushing load,
Whose forms are bending low,
Who toil along the climbing way
With painful steps and slow;
Look now, for glad and golden hours
Come swiftly on the wing;
Oh rest beside the weary road
And hear the angels sing.

For lo! the days are hastening on,
By prophets seen of old,
When with the ever-circling years
Shall come the time foretold,
When the new heaven and earth shall own
The Prince of Peace, their King,
And the whole world send back the song
Which now the angels sing.


I'll have a blue Christmas without you
I'll be so blue just thinking about you
Decorations of red on a green Christmas tree
Won't be the same dear, if you're not here with me

And when those blue snowflakes start falling
That's when those blue memories start calling
You'll be doin all right, with your Christmas of white
But I'll have a blue, blue blue blue Christmas

You'll be doin all right, with your Christmas of white,
But I'll have a blue, blue Christmas
    

Here comes Santa Claus, here comes Santa Claus, 
Right down Santa Claus lane
Vixen and Blitzen and all his reindeer
Pullin' on the reins
Bells are ringin', children singin'
All is merry and bright
Hang your stockings and say your prayers
'Cause Santa Claus comes tonight! 

Here comes Santa Claus, here comes Santa Claus, 
Right down Santa Claus lane
He's got a bag that's filled with toys
For boys and girls again
Hear those sleigh bells jingle jangle, 
Oh what a beautiful sight
So jump in bed and cover your head
'Cause Santa Claus comes tonight! 

Here comes Santa Claus, here comes Santa Claus, 
Right down Santa Claus lane
He doesn't care if you're rich or poor
He loves you just the same
Santa Claus knows we're all Gods children
That makes everything right
So fill your hearts with Christmas cheer
'Cause Santa Claus comes tonight! 

Here comes Santa Claus, here comes Santa Claus, 
Right down Santa Claus lane
He'll come around when the chimes ring out
That it's Christmas morn again
Peace on earth will come to all
If we just follow the light
So lets give thanks to the lord above
That Santa Claus comes tonight!
    
    
You know Dasher, and Dancer, and
Prancer, and Vixen,
Comet, and Cupid, and
Donner and Blitzen
But do you recall
The most famous reindeer of all

Rudolph, the red-nosed reindeer
had a very shiny nose
and if you ever saw it
you would even say it glows.

All of the other reindeer
used to laugh and call him names
They never let poor Rudolph
play in any reindeer games.

Then one foggy Christmas eve
Santa came to say:
"Rudolph with your nose so bright,
won't you guide my sleigh tonight?"

Then all the reindeer loved him
as they shouted out with glee,
Rudolph the red-nosed reindeer,
you'll go down in history!
    
    
We wish you a Merry Christmas; 
We wish you a Merry Christmas; 
We wish you a Merry Christmas and a Happy New Year. 
Good tidings we bring to you and your kin; 
Good tidings for Christmas and a Happy New Year.

Oh, bring us a figgy pudding; 
Oh, bring us a figgy pudding; 
Oh, bring us a figgy pudding and a cup of good cheer
We won't go until we get some; 
We won't go until we get some; 
We won't go until we get some, so bring some out here

We wish you a Merry Christmas; 
We wish you a Merry Christmas; 
We wish you a Merry Christmas and a Happy New Year.
    
    
O Come All Ye Faithful
Joyful and triumphant,
O come ye, O come ye to Bethlehem.
Come and behold Him,
Born the King of Angels;
O come, let us adore Him,
O come, let us adore Him,
O come, let us adore Him,
Christ the Lord.

O Sing, choirs of angels,
Sing in exultation,
Sing all that hear in heaven God's holy word.
Give to our Father glory in the Highest;
O come, let us adore Him,
O come, let us adore Him,
O come, let us adore Him,
Christ the Lord.

All Hail! Lord, we greet Thee,
Born this happy morning,
O Jesus! for evermore be Thy name adored.
Word of the Father, now in flesh appearing;
O come, let us adore Him,
O come, let us adore Him,
O come, let us adore Him,
Christ the Lord.
    
    
Hark the herald angels sing
"Glory to the newborn King!
Peace on earth and mercy mild
God and sinners reconciled"
Joyful, all ye nations rise
Join the triumph of the skies
With the angelic host proclaim:
"Christ is born in Bethlehem"
Hark! The herald angels sing
"Glory to the newborn King!"

Christ by highest heav'n adored
Christ the everlasting Lord!
Late in time behold Him come
Offspring of a Virgin's womb
Veiled in flesh the Godhead see
Hail the incarnate Deity
Pleased as man with man to dwell
Jesus, our Emmanuel
Hark! The herald angels sing
"Glory to the newborn King!"

Hail the heav'n-born Prince of Peace!
Hail the Son of Righteousness!
Light and life to all He brings
Ris'n with healing in His wings
Mild He lays His glory by
Born that man no more may die
Born to raise the sons of earth
Born to give them second birth
Hark! The herald angels sing
"Glory to the newborn King!"
    
    
Have yourself a merry little Christmas,
Let your heart be light
From now on,
our troubles will be out of sight

Have yourself a merry little Christmas,
Make the Yule-tide gay,
From now on, 
our troubles will be miles away.

Here we are as in olden days,
Happy golden days of yore.
Faithful friends who are dear to us
Gather near to us once more.

Through the years 
We all will be together,
If the Fates allow
Hang a shining star upon the highest bough.
And have yourself A merry little Christmas now.
    
    
It came upon the midnight clear,
That glorious song of old,
From angels bending near the earth,
To touch their harps of gold:
"Peace on the earth, goodwill to men
From heavens all gracious King!"
The world in solemn stillness lay
To hear the angels sing.

Still through the cloven skies they come,
With peaceful wings unfurled;
And still their heavenly music floats
O'er all the weary world:
Above its sad and lowly plains
They bend on hovering wing,
And ever o'er its Babel sounds
The blessed angels sing.

O ye beneath life's crushing load,
Whose forms are bending low,
Who toil along the climbing way
With painful steps and slow;
Look now, for glad and golden hours
Come swiftly on the wing;
Oh rest beside the weary road
And hear the angels sing.

For lo! the days are hastening on,
By prophets seen of old,
When with the ever-circling years
Shall come the time foretold,
When the new heaven and earth shall own
The Prince of Peace, their King,
And the whole world send back the song
Which now the angels sing.
    
    
O come, O come, Emmanuel
And ransom captive Israel
That mourns in lonely exile here
Until the Son of God appear
Rejoice! Rejoice! Emmanuel
Shall come to thee, O Israel.

O come, Thou Rod of Jesse, free
Thine own from Satan's tyranny
From depths of Hell Thy people save
And give them victory o'er the grave
Rejoice! Rejoice! Emmanuel
Shall come to thee, O Israel.

O come, Thou Day-Spring, come and cheer
Our spirits by Thine advent here
Disperse the gloomy clouds of night
And death's dark shadows put to flight.
Rejoice! Rejoice! Emmanuel
Shall come to thee, O Israel.

O come, Thou Key of David, come,
And open wide our heavenly home;
Make safe the way that leads on high,
And close the path to misery.
Rejoice! Rejoice! Emmanuel
Shall come to thee, O Israel.

O come, O come, Thou Lord of might,
Who to Thy tribes, on Sinai's height,
In ancient times did'st give the Law,
In cloud, and majesty and awe.
Rejoice! Rejoice! Emmanuel
Shall come to thee, O Israel.
    
    
Angels we have heard on high
Sweetly singing o?er the plains,
And the mountains in reply
Echoing their joyous strains.

Gloria, in excelsis Deo!
Gloria, in excelsis Deo!

Shepherds, why this jubilee?
Why your joyous strains prolong?
What the gladsome tidings be
Which inspire your heavenly song?

Gloria, in excelsis Deo!
Gloria, in excelsis Deo!

Come to Bethlehem and see
Christ Whose birth the angels sing;
Come, adore on bended knee,
Christ the Lord, the newborn King.

Gloria, in excelsis Deo!
Gloria, in excelsis Deo!

See Him in a manger laid,
Whom the choirs of angels praise;
Mary, Joseph, lend your aid,
While our hearts in love we raise.

Gloria, in excelsis Deo!
Gloria, in excelsis Deo!
    
    
Grandma got run over by a reindeer
Walking home from our house Christmas eve
You can say there's no such thing as Santa
But as for me and Grandpa, we believe

She'd been drinkin' too much egg nog
And we'd begged her not to go
But she'd left her medication
So she stumbled out the door into the snow

When they found her Christmas mornin'
At the scene of the attack
There were hoof prints on her forehead
And incriminatin' Claus marks on her back

Grandma got run over by a reindeer
Walkin' home from our house Christmas eve
You can say there's no such thing as Santa
But as for me and Grandpa, we believe

Now were all so proud of Grandpa
He's been takin' this so well
See him in there watchin' football
Drinkin' beer and playin' cards with cousin Belle

It's not Christmas without Grandma
All the family's dressed in black
And we just can't help but wonder
Should we open up her gifts or send them back?

Grandma got run over by a reindeer
Walkin' home from our house Christmas eve
You can say there's no such thing as Santa
But as for me and Grandpa, we believe

Now the goose is on the table
And the pudding made of pig
And a blue and silver candle
That would just have matched the hair in Grandma's wig

I've warned all my friends and neighbors
Better watch out for yourselves
They should never give a license
To a man who drives a sleigh and plays with elves

Grandma got run over by a reindeer
Walkin' home from our house, Christmas eve
You can say there's no such thing as Santa
But as for me and Grandpa, we believe!
    
    
Said the night wind to the little lamb,
do you see what I see
Way up in the sky, little lamb,
do you see what I see
A star, a star, dancing in the night
With a tail as big as a kite
With a tail as big as a kite

Said the little lamb to the shepherd boy,
do you hear what I hear
Ringing through the sky, shepherd boy,
do you hear what I hear
A song, a song, high above the trees
With a voice as big as the sea
With a voice as big as the sea

Said the shepherd boy to the mighty king,
do you know what I know
In your palace warm, mighty king,
do you know what I know
A Child, a Child shivers in the cold
Let us bring Him silver and gold
Let us bring Him silver and gold
Said the king to the people everywhere,
listen to what I say
Pray for peace, people everywhere!
listen to what I say
The Child, the Child, sleeping in the night
He will bring us goodness and light
He will bring us goodness and light
    
    
God rest ye merry, gentlemen
Let nothing you dismay
Remember, Christ, our Saviour
Was born on Christmas day
To save us all from Satan's power
When we were gone astray
O tidings of comfort and joy,
Comfort and joy
O tidings of comfort and joy

In Bethlehem, in Israel,
This blessed Babe was born
And laid within a manger
Upon this blessed morn
The which His Mother Mary
Did nothing take in scorn
O tidings of comfort and joy,
Comfort and joy
O tidings of comfort and joy

From God our Heavenly Father
A blessed Angel came;
And unto certain Shepherds
Brought tidings of the same:
How that in Bethlehem was born
The Son of God by Name.
O tidings of comfort and joy,
Comfort and joy
O tidings of comfort and joy

"Fear not then," said the Angel,
"Let nothing you affright,
This day is born a Saviour
Of a pure Virgin bright,
To free all those who trust in Him
From Satan's power and might."
O tidings of comfort and joy,
Comfort and joy
O tidings of comfort and joy

The shepherds at those tidings
Rejoiced much in mind,
And left their flocks a-feeding
In tempest, storm and wind:
And went to Bethlehem straightway
The Son of God to find.
O tidings of comfort and joy,
Comfort and joy
O tidings of comfort and joy

And when they came to Bethlehem
Where our dear Saviour lay,
They found Him in a manger,
Where oxen feed on hay;
His Mother Mary kneeling down,
Unto the Lord did pray.
O tidings of comfort and joy,
Comfort and joy
O tidings of comfort and joy

Now to the Lord sing praises,
All you within this place,
And with true love and brotherhood
Each other now embrace;
This holy tide of Christmas
All other doth deface.
O tidings of comfort and joy,
Comfort and joy
O tidings of comfort and joy
    
    
Deck the halls with boughs of holly, 
Fa la la la la, la la la la. 
Tis the season to be jolly, 
Fa la la la la, la la la la. 

Don we now our gay apparel, 
Fa la la, la la la, la la la. 
Troll the ancient Yule tide carol, 
Fa la la la la, la la la la. 

See the blazing Yule before us, 
Fa la la la la, la la la la. 
Strike the harp and join the chorus. 
Fa la la la la, la la la la. 

Follow me in merry measure, 
Fa la la la la, la la la la. 
While I tell of Yule tide treasure, 
Fa la la la la, la la la la. 

Fast away the old year passes, 
Fa la la la la, la la la la. 
Hail the new, ye lads and lasses, 
Fa la la la la, la la la la. 

Sing we joyous, all together, 
Fa la la la la, la la la la. 
Heedless of the wind and weather, 
Fa la la la la, la la la la.
  </textarea>
  <p>Output</p>
  <div id="output"></div>
<script>
var source = 'kringle', 
    corpus = $('#'+source).val(),
    composition = source == 'kringle' ?
      {stanzas: 5, lines: 4, count: 7} :
      {stanzas: 5, lines: 1, count: 20},
    $out = $('#output'),
    $refresh = $('<button/>').html('Refresh').appendTo('body'),
    $dump = $('<div id="dump"/>').appendTo('body'),
    log = function(k, v){console.log(k+':',v);},
    dump = function(obj){$dump.append(JSON.stringify(obj,null,'\t'));},
    
    lex = {
      cfg: {
        optimize: false,
        power: 2,
        topThreshold: 0.2,
        topCount: 15,
        bestScoreMaxTries: 50
      },
      meta: {},
      list: {},
      output: {},
      capitalize: function(string){
        return string[0].toUpperCase() + string.slice(1);
      },
      tokenize: function(corpus){
        var tokens = corpus        
          .replace(/(http|pic\.)\S*/g,'')
          .replace(/\n+/g,' BR ')
          .split(/[^A-Za-z0-9\'\\n\@\_\#]+/)
          .slice(1);
        return tokens;
      },
      build: function(corpus){
        var words = lex.tokenize(corpus);
        var time = new Date();
        $.each(words, function(k, word){
          lex.tally(word ,lex.list);
          if (words[k+1]) {
            if (!lex.list[word].next) lex.list[word].next = {};
            lex.tally(words[k+1], lex.list[word].next);
          }
        });
        // prevent double linebreak
        delete lex.list.BR.next.BR;
        lex.meta = {
          buildTime: (new Date() - time) + 'ms',
          rawCount: words.length,
          tallyCount: Object.keys(lex.list).length,
          lines: lex.list.BR.count,
          top: lex.sortArr(lex.objToArr(lex.list))
            .filter(function(v){
              return util.isRelevant(v.word);
            })
            .slice(0, lex.cfg.topCount)
        };
        dump(lex.meta.top.map(function(v){return v.word+' '+v.count;}));
      },
      tally: function(item, list, value){
        var inc = value || 1;
        if (list[item]) {
          list[item].count += inc;
        } else {
          list[item] = {};
          list[item].count = inc;
        }
        return list;
      },
      isInArr: function(arr, key, val) {
        var found = false;
        $.each(arr, function(k,v){
          if (v[key] == val) found = v;
        });
        return found;
      },
      getPropArr: function(arr, key) {
        var out = [];
        $.each(arr, function(k,v){
          out.push(v[key]);
        });
        return out;
      },
      removeByProp: function(arr, key, val) {
        var out = [];
        $.each(arr, function(k,v){
          if (v[key] == val) out.push(v);
        });
        return out.length ? out : arr;
      },
      objToArr: function(obj){
        var arr = [], tempObj = {};
        $.each(obj, function(k,v){
          tempObj = v;
          tempObj.word = k;
          arr.push(tempObj);
        });
        return arr;
      },
      sortArr: function(arr) {
        return arr.sort(function(a,b){return b.count - a.count;});
      },
      redistributeArr: function(arr, power){
        var out = [];
        //if (1) return lex.sortArr(arr).slice(0,2);
        $.each(arr, function(k,v){
          var topWord = lex.meta.top[v.word];
          //if (topWord) v.count = topWord.count;
          for(var i=0, ii=Math.round(Math.pow(v.count, power)); i < ii; i++){
            out.push(v);
          }
        });
        return out;
      },
      getRandom: function(arr){
        var i = Math.floor(Math.random()*arr.length);
        return arr[i];
      },
      getWeightedRandom: function(obj, exclude){
        var out = lex.objToArr(obj);
            if (out.length == 1) return out[0];
            out = out.filter(function(v){return v.word !== exclude;});
            out = lex.redistributeArr(out, lex.cfg.power);
            out = lex.getRandom(out);
        return out;
      }
    };

var getScore = function(string, markup){
  var score = 0, words = string.split(' '), scoredWords = [], out = '';
  $.each(words, function(k,v){
    if (lex.isInArr(lex.meta.top, 'word', v) && scoredWords.indexOf(v) == -1) {
      scoredWords.push(v);
      score++;// += lex.list[v].count;
      //v += '<sup>'+lex.list[v].count+'</sup>';
      out += '<span class="hilight">'+v+'</span> ';
    } else {
      out += v + ' ';
    }
  });
  //score = (score / lex.cfg.topCount).toFixed(2);
  return markup ? out + '<br/>' + score : score;
};
var getBestScore = function(lines, wordsPerLine, scoreMin){
  var temp = {txt: '', score:0}, best = {txt:'', score:0};
  for(k=0; k<lex.cfg.bestScoreMaxTries; k++) {
    temp.txt = generateLines(lines, wordsPerLine);
    temp.score = getScore(temp.txt);
    if (temp.score > best.score) {
      best.score = temp.score; best.txt = temp.txt;
    }
  }
  return getScore(best.txt, true)+' / '+k+' tries / '+ best.txt.length+' chars';
};
var generateLines = function(newlineMax, wordsPerLine) {
  var i = 0,
      ii = newlineMax * wordsPerLine,
      //timer = new Date(),
      lineCount = 0,
      newline = 0,
      exclude = 'BR',
      item = lex.getWeightedRandom(lex.list, exclude), //lex.list.BR,
      output = '';
  while (newline < newlineMax && i < ii) {
    output += item.word.replace('BR',/*'| '+lineCount+*/'<br/>')+' ';
    if (item.word == 'BR') {
      newline++;
      lineCount = 0;
    }
    if (lineCount < wordsPerLine * 0.75) exclude = 'BR';
    if (lineCount > wordsPerLine) exclude = item.word;
    var nextWord = lex.getWeightedRandom(item.next ? item.next : lex.list, exclude).word;
    item = lex.list[nextWord];
    lineCount++;
    i++;
  }
  //log('time',new Date() - timer);
  //if (i==ii) output += '= '+ii+'<br/>';
  output = lex.capitalize(output);
  return output;
};
var buildOutput = function(opt) {
  var out = '';
  for (s=0;s<opt.stanzas;s++){
    // noprotect
    out += '<p>' + (
        lex.cfg.optimize ? 
          (getBestScore(opt.lines, opt.count, lex.cfg.topThreshold)) :
          (generateLines(opt.lines, opt.count))
      ) + '</p>';
  }
  return out;
};
var printOutput = function(arr) {
  var out = '';
  arr = lex.sortArr(arr);
  $.each(arr, function(k,v){
    out += '<p>'+getScore(v, true)+'</p>';
  });
  return out;
};
var getAjax = function(){
  $.ajax({
    url: 'http://twndr.com:5000',
    data: {count: 100, geocode: '37.22,-80.42,15mi', lang: 'en'},
    dataType: 'jsonp',
    success: function(data){
      $.each(data.statuses,function(k,v){
        //console.log(v.text);
        lex.build(v.text);
      });
    }
  });
};

$(document).ready(function(){
  
  lex.build(util.twitterScrape(corpus));    
  
  $refresh
    .click(function(){
      $out.html(buildOutput(composition));
    }).click();  
    
});
</script>
</body>
</html>
  
